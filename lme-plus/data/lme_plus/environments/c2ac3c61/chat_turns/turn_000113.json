{
  "turn_global_index": 113,
  "session_index": 11,
  "session_id": "sharegpt_CQ3HZO9_53",
  "turn_in_session": 4,
  "date": "2023/05/23 (Tue) 00:31",
  "role": "assistant",
  "content": "Sure, here's an example code for the updated design with over-temperature and over-current protection, and a display to show the current direction and speed of the motor:\n```scss\n#include <Adafruit_SSD1306.h>\n#include <Wire.h>\n\n// OLED display\n#define OLED_RESET     4\nAdafruit_SSD1306 display(OLED_RESET);\n\n// Pin definitions\n#define PWM1_PIN        9\n#define PWM2_PIN        10\n#define INA_PIN         2\n#define INB_PIN         3\n#define CURRENT_PIN     A0\n#define TEMP_PIN        A1\n\n// Constants\n#define MAX_CURRENT     15      // Maximum current in Amps\n#define MAX_TEMP        80      // Maximum temperature in degrees Celsius\n#define UPDATE_INTERVAL 100     // Interval for updating display in ms\n\n// Global variables\nint current_direction = 0;      // 0 for forward, 1 for reverse\nfloat current_speed = 0.0;      // Current motor speed in RPM\nfloat current_current = 0.0;    // Current current in Amps\nfloat current_temp = 0.0;       // Current temperature in degrees Celsius\n\n// Function prototypes\nvoid update_display();\nvoid set_direction(int direction);\nvoid set_speed(float speed);\nvoid set_current_limit(float limit);\nvoid check_over_current();\nvoid check_over_temp();\n\nvoid setup() {\n  // Initialize serial communication\n  Serial.begin(9600);\n  \n  // Initialize OLED display\n  display.begin(SSD1306_SWITCHCAPVCC, 0x3C);\n  display.clearDisplay();\n  display.setTextSize(2);\n  display.setTextColor(SSD1306_WHITE);\n  display.setCursor(0,0);\n  display.println(\"Motor Control\");\n  display.display();\n  delay(1000);\n  \n  // Initialize pins\n  pinMode(INA_PIN, OUTPUT);\n  pinMode(INB_PIN, OUTPUT);\n  pinMode(PWM1_PIN, OUTPUT);\n  pinMode(PWM2_PIN, OUTPUT);\n  pinMode(CURRENT_PIN, INPUT);\n  pinMode(TEMP_PIN, INPUT);\n  \n  // Set initial direction and speed\n  set_direction(0);\n  set_speed(0.0);\n}\n\nvoid loop() {\n  // Read current and temperature\n  current_current = analogRead(CURRENT_PIN) * (5.0 / 1023.0) * (MAX_CURRENT / 5.0);\n  current_temp = (analogRead(TEMP_PIN) * (5.0 / 1023.0) * 100.0) - 50.0;\n  \n  // Check for over-current and over-temperature\n  check_over_current();\n  check_over_temp();\n  \n  // Update display\n  static unsigned long last_update_time = 0;\n  if (millis() - last_update_time > UPDATE_INTERVAL) {\n    update_display();\n    last_update_time = millis();\n  }\n  \n  // Add main control code here\n}\n\nvoid update_display() {\n  // Clear display\n  display.clearDisplay();\n  \n  // Print direction and speed\n  display.setCursor(0, 0);\n  display.print(\"Direction: \");\n  if (current_direction == 0) {\n    display.println(\"Forward\");\n  } else {\n    display.println(\"Reverse\");\n  }\n  display.print(\"Speed: \");\n  display.print(current_speed);\n  display.println(\" RPM\");\n  \n  // Print current and temperature\n  display.print(\"Current: \");\n  display.print(current_current);\n  display.println(\" A\");\n  display.print(\"Temperature: \");\n  display.print(current_temp);\n  display.println(\" C\");\n  \n  // Display buffer\n  display.display();\n}\n\nvoid set_direction(int direction) {\n  current_direction = direction;\n  if (direction == 0) {\n```",
  "has_answer": false
}