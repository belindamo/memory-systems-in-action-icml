{
  "session_id": "sharegpt_MJKLmq1_0",
  "session_index": 24,
  "date": "2023/03/10 (Fri) 16:03",
  "turns": [
    {
      "role": "user",
      "content": "can you convert this to suitescript 2.0:\nfunction getPromoPrices(){\n var column = [new nlobjSearchColumn(\"custrecord\\_parent\\_promo\",null,\"GROUP\")];\n var ppm = nlapiSearchRecord(\"customrecord\\_special\\_pricing\\_detail\",null, [\n [\"custrecord\\_detail\\_customer\",\"anyof\",\"@NONE@\"], \n \"AND\", \n [\"custrecord\\_parent\\_promo\",\"noneof\",\"@NONE@\"]\n ],column);\n \n var promoprices = [];\n for(var i = 0; i < ppm.length; i++){\n promoprices.push({ type: \"customrecord\\_promo\\_header\", id: ppm[i].getValue(column[0]) });\n }\n return promoprices;\n}\n\nfunction scheduled(type){ \n \n var context = nlapiGetContext();\n var recordType = context.getSetting('SCRIPT', 'custscript\\_uc\\_rectype');\n var recordId = context.getSetting('SCRIPT', 'custscript\\_uc\\_recid');\n \n if(recordId){\n run(recordId, recordType, context);\n } else {\n var ppm = getPromoPrices() || [];\n nlapiLogExecution('DEBUG', 'Promo Prices', ppm.length);\n \n for(var i = 0; i < ppm.length; i++){\n run(ppm[i].id, ppm[i].type, context);\n context = nlapiGetContext();\n nlapiLogExecution('debug', 'remaining usage', context.getRemainingUsage());\n if (context.getRemainingUsage() <= 500) {\n var status = nlapiScheduleScript(context.getScriptId())\n if ( status == 'QUEUED' )\n break;\n }\n }\n }\n}\n\n/\\*\\*\n \\* @param {String} type Context Types: scheduled, ondemand, userinterface, aborted, skipped\n \\* @returns {Void}\n \\*/\nfunction run(recordId, recordType, context) {\n try {\n \n var record = nlapiLoadRecord(recordType, recordId);\n if (recordType == 'customrecord\\_promo\\_header') {\n var recordStatus = record.getFieldValue('custrecord\\_promohead\\_status');\n var startDate = record.getFieldValue('custrecord\\_promohead\\_startdate');\n var endDate = record.getFieldValue('custrecord\\_promohead\\_enddate');\n if (recordStatus == 8) {\n var copiedFrom = record.getFieldValue('custrecord\\_promohead\\_copiedfrom');\n var filter = new nlobjSearchFilter('custrecord\\_parent\\_promo', null, 'anyof', copiedFrom);\n var filterDet= [['custrecord\\_parent\\_promo', 'anyof', copiedFrom]];\n var schRec = nlapiLoadSearch('customrecord\\_special\\_pricing\\_detail', 'customsearch\\_child\\_items\\_sch');\n var filExp = schRec.getFilterExpression();\n schRec.setFilterExpression(filterDet);\n var schResultSet = schRec.runSearch();\n var index = 0;\n var max = 1000;\n while (true) {\n var schDetail = schResultSet.getResults(index, max);\n if(isNullOrEmpty(schDetail) || schDetail.length <= 0) {\n break;\n }\n index = max;\n max += 1000;\n \n if (schDetail) {\n for (var i = 0; i < schDetail.length; i++) {\n nlapiLogExecution('DEBUG', 'sp Id', schDetail[i].getId());\n \n //if (context.getRemainingUsage() <= 100) nlapiYieldScript();\n var item = schDetail[i].getValue('custrecord\\_detail\\_item');\n var option = schDetail[i].getValue('custrecord\\_detail\\_option');\n var basePrice = schDetail[i].getValue('custrecord\\_detail\\_baseprice');\n var usualPrice = schDetail[i].getValue('custrecord\\_detail\\_usualrate');\n \n var qty1 = schDetail[i].getValue('custrecord\\_detail\\_qty1');\n var price1 = schDetail[i].getValue('custrecord\\_detail\\_rate1');\n \n var qty2 = schDetail[i].getValue('custrecord\\_detail\\_qty2');\n var price2 = schDetail[i].getValue('custrecord\\_detail\\_rate2');\n \n var qty3 = schDetail[i].getValue('custrecord\\_detail\\_qty3');\n var price3 = schDetail[i].getValue('custrecord\\_detail\\_rate3');\n \n var qty4 = schDetail[i].getValue('custrecord\\_detail\\_qty4');\n var price4 = schDetail[i].getValue('custrecord\\_detail\\_rate4');\n \n var qty5 = schDetail[i].getValue('custrecord\\_detail\\_qty5');\n var price5 = schDetail[i].getValue('custrecord\\_detail\\_rate5');\n \n var customersStr = schDetail[i].getValue('custrecord\\_detail\\_customer');\n var customerArr = customersStr.split(\",\");\n nlapiLogExecution('DEBUG', typeof customerArr1);\n \n nlapiLogExecution('DEBUG', 'customers length', customerArr.length);\n var marketing = schDetail[i].getValue('custrecord\\_detail\\_marketingprice');\n var newDetail = nlapiCreateRecord('customrecord\\_special\\_pricing\\_detail');\n \n newDetail.setFieldValue('custrecord\\_parent\\_promo', recordId);\n newDetail.setFieldValue('custrecord\\_detail\\_item', item);\n newDetail.setFieldValue('custrecord\\_detail\\_option', option);\n newDetail.setFieldValue('custrecord\\_detail\\_baseprice', basePrice);\n newDetail.setFieldValue('custrecord\\_detail\\_usualrate', usualPrice);\n newDetail.setFieldValue('custrecord\\_detail\\_qty1', qty1);\n newDetail.setFieldValue('custrecord\\_detail\\_rate1', price1);\n newDetail.setFieldValue('custrecord\\_detail\\_qty2', qty2);\n newDetail.setFieldValue('custrecord\\_detail\\_rate2', price2);\n \n newDetail.setFieldValue('custrecord\\_detail\\_qty3', qty3);\n newDetail.setFieldValue('custrecord\\_detail\\_rate3', price3);\n newDetail.setFieldValue('custrecord\\_detail\\_qty4', qty4);\n newDetail.setFieldValue('custrecord\\_detail\\_rate4', price4);\n \n newDetail.setFieldValue('custrecord\\_detail\\_qty5', qty5);\n newDetail.setFieldValue('custrecord\\_detail\\_rate5', price5);\n \n newDetail.setFieldValue('custrecord\\_detail\\_startdate', startDate);\n newDetail.setFieldValue('custrecord\\_detail\\_enddate', endDate);\n newDetail.setFieldValue('custrecord\\_detail\\_customer', customerArr);\n newDetail.setFieldValue('custrecord\\_detail\\_marketingprice', marketing);\n nlapiSubmitRecord(newDetail, false, true);\n \n \n }\n }\n \n }\n \n \n \n }\n else {\n var someCust = record.getFieldValues('custrecord\\_promohead\\_child');\n var startDate = record.getFieldValue('custrecord\\_promohead\\_startdate');\n var endDate = record.getFieldValue('custrecord\\_promohead\\_enddate');\n var customer = record.getFieldValue('custrecord\\_parenthead\\_customer');\n \n var filCust = new Array(); \n filCust.push(new nlobjSearchFilter('parent', null, 'anyof', customer));\n filCust.push(new nlobjSearchFilter('isinactive', null, 'is', 'F'));\n //filCust.push(new nlobjSearchFilter('isjob', null, 'is', 'F'));\n var childCust = nlapiSearchRecord('customer', null, filCust, null);\n \n var allChildArray = new Array();\n \n if (childCust) {\n allChildArray.push(customer);\n for (var j = 0; j < childCust.length; j++) {\n \n allChildArray.push(childCust[j].getId());\n }\n \n }\n \n var someCustArray = new Array();\n someCustArray.push(customer);\n if (!isNullOrEmpty(someCust)) {\n for (var j = 0; j < someCust.length; j++) {\n someCustArray.push(someCust[j]);\n }\n }\n \n var lineCount = record.getLineItemCount('recmachcustrecord\\_parent\\_promo');\n var custArray = new Array();\n custArray.push(customer);\n \n nlapiLogExecution('DEBUG', '1', '');\n var filterDet= [['custrecord\\_parent\\_promo', 'anyof', recordId]];\n var schRec = nlapiLoadSearch('customrecord\\_special\\_pricing\\_detail', 'customsearch\\_child\\_items\\_sch');\n var filExp = schRec.getFilterExpression();\n nlapiLogExecution('DEBUG', '2', '');\n \n schRec.setFilterExpression(filterDet);\n var schResultSet = schRec.runSearch();\n nlapiLogExecution('DEBUG', '2b', '');\n var index = 0;\n var max = 1000;\n \n \n while (true) {\n var schDetail = schResultSet.getResults(index, max);\n if(isNullOrEmpty(schDetail) || schDetail.length <= 0) {\n break;\n }\n index = max;\n max += 1000;\n \n if (schDetail) {\n for (var i = 0; i < schDetail.length; i++) {\n //if (context.getRemainingUsage() <= 100) nlapiYieldScript();\n var detId = schDetail[i].getId();\n nlapiLogExecution('DEBUG', 'child id', detId);\n var recordDet = nlapiLoadRecord('customrecord\\_special\\_pricing\\_detail', detId, {recordmode: 'dynamic'});\n \n var option = recordDet.getFieldValue('custrecord\\_detail\\_option');\n \n if (option == '1') {\n recordDet.setFieldValue('custrecord\\_detail\\_customer', allChildArray);\n }\n if (option == '2') {\n recordDet.setFieldValue('custrecord\\_detail\\_customer', someCustArray);\n }\n if (option == '3') {\n recordDet.setFieldValue('custrecord\\_detail\\_customer', customer);\n \n }\n \n recordDet.setFieldValue('custrecord\\_detail\\_startdate', startDate);\n recordDet.setFieldValue('custrecord\\_detail\\_enddate', endDate);\n nlapiSubmitRecord(recordDet, true, true);\n \n \n }\n }\n }\n }\n \n nlapiSubmitField(recordType, recordId, 'custrecord\\_promohead\\_status', 4);\n \n \n }\n \n \n if (recordType == 'customrecord\\_contract\\_pricing') {\n \n var contractReview = record.getFieldValue('custrecord\\_cp\\_contractreview');\n var startDate = record.getFieldValue('custrecord\\_cp\\_startdate');\n //var location = record.getFieldValue('custrecord\\_cp\\_location');\n var filters = new Array();\n var customer = record.getFieldValue('custrecord\\_cp\\_parentcustomer');\n var someCust = record.getFieldValues('custrecord\\_cp\\_child');\n \n var filCust = new Array(); \n filCust.push(new nlobjSearchFilter('parent', null, 'anyof', customer));\n filCust.push(new nlobjSearchFilter('isinactive', null, 'is', 'F'));\n //filCust.push(new nlobjSearchFilter('isjob', null, 'is', 'F'));\n var childCust = nlapiSearchRecord('customer', null, filCust, null);\n var allChildArray = new Array();\n //allChildArray.push(customer);\n if (childCust) {\n nlapiLogExecution('DEBUG', 'childcust length', childCust.length);\n for (var j = 0; j < childCust.length; j++) {\n allChildArray.push(childCust[j].getId());\n }\n nlapiLogExecution('DEBUG', 'childcust all', JSON.stringify(allChildArray));\n }\n \n var someCustArray = new Array();\n someCustArray.push(customer);\n if (!isNullOrEmpty(someCust)) {\n for (var j = 0; j < someCust.length; j++) {\n someCustArray.push(someCust[j]);\n }\n }\n \n //\\*\\*\\*\\* add here\n nlapiLogExecution('DEBUG', '1', '');\n var filterDet= [['custrecord\\_contract\\_parent', 'anyof', recordId]];\n var schRec = nlapiLoadSearch('customrecord\\_special\\_pricing\\_detail', 'customsearch\\_child\\_items\\_sch');\n var filExp = schRec.getFilterExpression();\n nlapiLogExecution('DEBUG', '2', '');\n \n schRec.setFilterExpression(filterDet);\n var schResultSet = schRec.runSearch();\n nlapiLogExecution('DEBUG', '2b', '');\n var index = 0;\n var max = 1000;\n \n \n while (true) {\n var schDetail = schResultSet.getResults(index, max);\n if(isNullOrEmpty(schDetail) || schDetail.length <= 0) {\n break;\n }\n index = max;\n max += 1000;\n \n if (schDetail) {\n for (var i = 0; i < schDetail.length; i++) {\n //if (context.getRemainingUsage() <= 100) nlapiYieldScript();\n var detId = schDetail[i].getId();\n nlapiLogExecution('DEBUG', 'child id', detId);\n var recordDet = nlapiLoadRecord('customrecord\\_special\\_pricing\\_detail', detId, {recordmode: 'dynamic'});\n recordDet.setFieldValue('custrecord\\_detail\\_contractreviewdate', contractReview);\n recordDet.setFieldValue('custrecord\\_detail\\_startdate', startDate);\n var option = recordDet.getFieldValue('custrecord\\_detail\\_option');\n if (option == 1) {\n recordDet.setFieldValue('custrecord\\_detail\\_customer', allChildArray);\n \n }\n if (option == 2) {\n recordDet.setFieldValue('custrecord\\_detail\\_customer', someCustArray);\n \n }\n \n if (option == '3') {\n recordDet.setFieldValue('custrecord\\_detail\\_customer', customer);\n \n }\n nlapiSubmitRecord(recordDet, true, true);\n \n }\n }\n }\n nlapiSubmitField(recordType, recordId, 'custrecord\\_cp\\_status', 4);\n \n }\n \n \n \n if (recordType == 'customrecord\\_catalogue\\_pricing') {\n var startDate = record.getFieldValue('custrecord\\_cat\\_startdate');\n var endDate = record.getFieldValue('custrecord\\_cat\\_enddate');\n var oldStatus = record.getFieldValue('custrecord\\_cat\\_oldstatus');\n var lineCount = record.getLineItemCount('recmachcustrecord\\_parent\\_catalogue');\n \n for (var i = 1; i <= lineCount; i++) {\n \n //if (context.getRemainingUsage() <= 100) nlapiYieldScript();\n \n record.setLineItemValue('recmachcustrecord\\_parent\\_catalogue', 'custrecord\\_detail\\_startdate', i, startDate);\n record.setLineItemValue('recmachcustrecord\\_parent\\_catalogue', 'custrecord\\_detail\\_enddate', i, endDate);\n \n }\n \n record.setFieldValue('custrecord\\_cat\\_status', oldStatus);\n nlapiSubmitRecord(record, false, true);\n \n }\n \n \n }\n catch (e) {\n if (recordType == 'customrecord\\_promo\\_header') nlapiSubmitField(recordType, recordId, 'custrecord\\_promohead\\_status', 5, false);\n if (recordType == 'customrecord\\_contract\\_pricing') nlapiSubmitField(recordType, recordId, 'custrecord\\_cp\\_status', 5, false);\n if (recordType == 'customrecord\\_catalogue\\_pricing') nlapiSubmitField(recordType, recordId, 'custrecord\\_cat\\_status', 6, false);\n //nlapiSubmitField(recordType, recordId, 'custrecord\\_cp\\_status', '5');\n if (e instanceof nlobjError) {\n nlapiLogExecution('DEBUG', 'Scheduled', e.getCode() + '\\n' + e.getDetails());\n \n }\n else {\n nlapiLogExecution('DEBUG', 'Scheduled - unexpected', e.toString());\n \n }\n }\n}"
    },
    {
      "role": "assistant",
      "content": "Here is the SuiteScript 2.0 version of the provided code:\n```js\nfunction getPromoPrices() {\n  var column = [search.createColumn({\n    name: \"custrecord_parent_promo\",\n    join: null,\n    summary: \"GROUP\"\n  })];\n  var ppm = search.create({\n    type: \"customrecord_special_pricing_detail\",\n    filters: [\n      [\"custrecord_detail_customer\", \"anyof\", \"@NONE@\"],\n      \"AND\",\n      [\"custrecord_parent_promo\", \"noneof\", \"@NONE@\"]\n    ],\n    columns: column\n  }).run().getRange({ start\n```"
    }
  ]
}