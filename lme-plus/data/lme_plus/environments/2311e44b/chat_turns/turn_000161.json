{
  "turn_global_index": 161,
  "session_index": 15,
  "session_id": "sharegpt_YAiYuAD_7",
  "turn_in_session": 0,
  "date": "2023/05/23 (Tue) 15:51",
  "role": "assistant",
  "content": "Here are the steps to grant access to an external SharePoint site using the \"Azure AD Application\" method in C#:\n\n1. Register the Azure AD application: Register your Azure AD application in the Azure portal, and configure it to have the necessary permissions to access the external SharePoint site.\n2. Obtain an access token: Use the Azure AD application's client ID and client secret to obtain an access token from the Azure AD token endpoint. You can also use a user account's credentials to obtain an access token if the SharePoint site requires user authentication.\n3. Use the access token to access the SharePoint site: Pass the obtained access token as an authorization header in the HTTP request when accessing the SharePoint site's REST API.\n\nHere's an example of how to obtain an access token in C# using a user account's credentials:\n```csharp\nstring tenantId = \"your-tenant-id\";\nstring clientId = \"your-client-id\";\nstring userName = \"your-user-name\";\nstring password = \"your-password\";\nstring resource = \"https://your-sharepoint-site.sharepoint.com\";\n\nstring tokenEndpoint = $\"https://login.microsoftonline.com/{tenantId}/oauth2/token\";\n\nusing (var client = new HttpClient())\n{\n    var requestBody = new Dictionary<string, string>\n    {\n        { \"grant_type\", \"password\" },\n        { \"client_id\", clientId },\n        { \"resource\", resource },\n        { \"username\", userName },\n        { \"password\", password }\n    };\n\n    var request = new HttpRequestMessage(HttpMethod.Post, tokenEndpoint)\n    {\n        Content = new FormUrlEncodedContent(requestBody)\n    };\n\n    var response = await client.SendAsync(request);\n    response.EnsureSuccessStatusCode();\n\n    var responseContent = await response.Content.ReadAsStringAsync();\n    var responseData = JsonConvert.DeserializeObject<Dictionary<string, string>>(responseContent);\n    string accessToken = responseData[\"access_token\"];\n}\n```\nWith the obtained access token, you can now use it to access the external SharePoint site using the SharePoint REST API.\n\nHere's an example of how to create a new file in the SharePoint site using the access token:\n```csharp\nstring siteUrl = \"https://your-sharepoint-site.sharepoint.com\";\nstring apiUrl = $\"{siteUrl}/_api/web/lists/getbytitle('Documents')/RootFolder/Files/Add(url='your-file-name.txt', overwrite=true)\";\n\nusing (var client = new HttpClient())\n{\n    client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue(\"Bearer\", accessToken);\n\n    var requestBody = new StringContent(\"Your file content\", Encoding.UTF8, \"text/plain\");\n    var request = new HttpRequestMessage(HttpMethod.Post, apiUrl)\n    {\n        Content = requestBody\n    };\n\n    var response = await client.SendAsync(request);\n    response.EnsureSuccessStatusCode();\n}\n```\nHere are the steps to grant access to an external SharePoint site using the \"SharePoint App-Only principal\" method in C#:\n\n1. Register the SharePoint app:",
  "has_answer": false
}