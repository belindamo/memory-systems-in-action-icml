{
  "turn_global_index": 383,
  "session_index": 39,
  "session_id": "sharegpt_rXUzPzR_0",
  "turn_in_session": 7,
  "date": "2023/04/29 (Sat) 16:55",
  "role": "assistant",
  "content": "To ensure that child accounts' owners are updated when a parent account is changed, and the change is limited to when the existing account owner has the \"Sales\" role, you can create an Apex trigger. An Apex trigger allows for more complex conditions and actions compared to Process Builder.\n\nFollow these steps to create the Apex trigger:\n\n1. Navigate to Setup.\n2. In the Quick Find box, type \"Apex Triggers.\"\n3. Click on \"Apex Triggers\" in the search results.\n4. Click the \"New Trigger\" button.\n5. Give your trigger a name, such as \"UpdateChildAccountsOnParentChange,\" and choose the \"Account\" object.\n6. In the trigger editor, enter the following Apex code:\n```Apex\ntrigger UpdateChildAccountsOnParentChange on Account (after update) {\n    // Get a set of updated Account IDs\n    Set<Id> updatedAccountIds = new Set<Id>();\n    for (Account updatedAccount : Trigger.new) {\n        Account oldAccount = Trigger.oldMap.get(updatedAccount.Id);\n        if (updatedAccount.OwnerId != oldAccount.OwnerId && updatedAccount.ParentId == null) {\n            updatedAccountIds.add(updatedAccount.Id);\n        }\n    }\n\n    // Check if any accounts were updated\n    if (!updatedAccountIds.isEmpty()) {\n        // Get the Sales role ID\n        UserRole salesRole = [SELECT Id FROM UserRole WHERE Name = 'Sales' LIMIT 1];\n\n        // Get all child accounts related to updated parent accounts\n        List<Account> childAccountsToUpdate = [\n            SELECT Id, OwnerId, Owner.UserRoleId\n            FROM Account\n            WHERE ParentId IN :updatedAccountIds\n        ];\n\n        // Update the child accounts' owners if the current owner has the Sales role\n        for (Account childAccount : childAccountsToUpdate) {\n            if (childAccount.Owner.UserRoleId == salesRole.Id) {\n                Account updatedParentAccount = Trigger.newMap.get(childAccount.ParentId);\n                childAccount.OwnerId = updatedParentAccount.OwnerId;\n            }\n        }\n\n        // Perform the update\n        update childAccountsToUpdate;\n    }\n}\n```\n1. Click \"Save\" to create the trigger.\n\nThis Apex trigger will execute after an account update. It checks if the parent account's owner has changed and if the account has no parent itself (meaning it's a parent account). If these conditions are met, the trigger retrieves all child accounts and checks if the child account owner has the \"Sales\" role. If so, the child account owner is updated to match the parent account's owner.\n\nPlease note that deploying an Apex trigger requires knowledge of Salesforce development and the trigger should be tested in a sandbox environment before deploying to production. Additionally, make sure to write test classes to ensure that the trigger meets the required test coverage.",
  "has_answer": false
}