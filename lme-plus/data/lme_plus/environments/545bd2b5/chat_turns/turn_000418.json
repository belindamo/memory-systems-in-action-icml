{
  "turn_global_index": 418,
  "session_index": 39,
  "session_id": "sharegpt_781f8jv_24",
  "turn_in_session": 7,
  "date": "2023/05/29 (Mon) 20:38",
  "role": "assistant",
  "content": "Sure! Here is a Python script that demonstrates how to download and process RNA-seq data from The Cancer Genome Atlas (TCGA) using the TCGA2STAT R package and the limma package in R.\n```python\n# Required packages\nimport rpy2.robjects as robjects\nimport pandas as pd\nimport numpy as np\nimport os\n\n# Set working directory\nos.chdir(\"path/to/working/directory\")\n\n# Install required R packages\nrobjects.r('install.packages(c(\"TCGA2STAT\", \"limma\"))')\n\n# Load R packages\nrobjects.r('library(TCGA2STAT)')\nrobjects.r('library(limma)')\n\n# Define function to download TCGA RNA-seq data\ndef download_tcga_rnaseq(cancer_type, num_samples):\n    \n    # Define R code to download TCGA RNA-seq data\n    r_code = f'''\n    data <- TCGAquery_subtype(project = \"TCGA-{cancer_type}\", \n                              subtype = \"tumor\", \n                              type = \"RNASeqV2\", \n                              sampleType = \"TP\", \n                              barcodePattern = NULL, \n                              platform = NULL, \n                              sampleLimit = {num_samples})\n    '''\n    \n    # Execute R code\n    data = robjects.r(r_code)\n    \n    # Convert R data.frame to pandas DataFrame\n    data = pd.DataFrame(np.array(data), columns=data.colnames)\n    \n    return data\n\n# Define function to preprocess TCGA RNA-seq data\ndef preprocess_tcga_rnaseq(data):\n    \n    # Transpose data\n    data = data.transpose()\n    \n    # Get gene expression values\n    gene_expression = data.iloc[1:]\n    \n    # Convert gene expression values to numeric\n    gene_expression = gene_expression.astype(float)\n    \n    # Normalize gene expression values\n    norm_gene_expression = np.log2(gene_expression + 1)\n    \n    # Get sample metadata\n    metadata = data.iloc[0]\n    \n    # Return normalized gene expression values and sample metadata\n    return norm_gene_expression, metadata\n\n# Download TCGA RNA-seq data for colorectal cancer\ncolorectal_data = download_tcga_rnaseq(\"COADREAD\", 50)\n\n# Preprocess TCGA RNA-seq data for colorectal cancer\nnorm_gene_expression, metadata = preprocess_tcga_rnaseq(colorectal_data)\n\n# Convert DataFrame to R matrix\nrobjects.globalenv['exprs'] = robjects.r.matrix(norm_gene_expression.values, \n                                                nrow=norm_gene_expression.shape[0], \n                                                ncol=norm_gene_expression.shape[1])\n\n# Convert sample metadata to R DataFrame\nrobjects.globalenv['sample_metadata'] = robjects.r.data.frame(metadata)\n\n# Define R code to create design matrix\nr_code = '''\ndesign <- model.matrix(~sample_metadata$subtype)\n'''\n\n# Execute R code\ndesign = robjects.r(r_code)\n\n# Define R code to fit linear model to gene expression data\nr_code = '''\nfit <- lmFit(exprs, design)\n'''\n\n# Execute R code\nfit = robjects.r(r_code)\n\n# Define R code to perform differential gene expression analysis\nr_code = '''\ncontrast.matrix <- makeContrasts(subtype.CMS2 - subtype.CMS4, levels=design)\nfit2 <- contrasts.fit(fit, contrast.matrix)\nfit2 <- eBayes(fit2)\nde_genes <- topTable(fit2, coef=1, adjust=\"fdr\", sort.by=\"B\", number=20)\n'''\n\n# Execute R code\nde_genes = robjects.r(r_code)\n\n# Convert R data\n```",
  "has_answer": false
}