{
  "turn_global_index": 86,
  "session_index": 8,
  "session_id": "sharegpt_3E7iMzS_93",
  "turn_in_session": 0,
  "date": "2023/05/22 (Mon) 22:34",
  "role": "assistant",
  "content": "The issue seems to be with the use of the `awk` command to extract the disk usage percentage. In some cases, the output of `df -h` can contain characters like `tmpfs`, `udev`, `none`, etc. in the disk usage column, which can't be converted to integers, and hence the `awk` command fails to extract the disk usage percentage.\n\nTo fix this issue, you can modify the script to exclude the non-integer disk usage percentages before checking if they are over 50%. You can do this by using the `grep` command to exclude lines containing non-integer values before processing the disks.\n\nHere's an updated version of the script that should work:\n```bash\n#!/bin/bash\n\n# Set the SparkPost API endpoint\nsparkpost_api=\"https://api.sparkpost.com/api/v1\"\n\n# Set your SparkPost API key\nsparkpost_api_key=\"5d4d97f437cb777fdaa63f6c9af1e62230e7f12b\"\n\n# Set the recipient email address\nto=\"example@example.com\"\n# set the from\nfrom=\"example@example.com\"\n\n# Set the email subject and message\nsubject=\"Disk space alert\"\nmessage=\"Your disk space on $(hostname) is over 50% full. Please take action to free up some space.\\n\\nDisk usage:\\n$(df -h)\"\n\n# Check disk usage and get the percentage used for each mounted file system\ndisks=$(df -h --output=source,pcent | tail -n +2 | grep -vE \"[^[:digit:]]+\" | sed 's/%//g' | tr -d '%')\nfor disk in $disks; do\n    disk_name=$(echo $disk | awk '{print $1}')\n    disk_usage=$(echo $disk | awk '{print $2}')\n    if [ \"$disk_usage\" -ge 50 ]; then\n        # If disk usage is over 50%, send an email via SparkPost API\n\n        # Generate the API request payload\n        payload=\"{\\\"options\\\":{\\\"sandbox\\\":false},\\\"content\\\":{\\\"from\\\":{\\\"email\\\":\\\"$from\\\"},\\\"subject\\\":\\\"$subject\\\",\\\"text\\\":\\\"$message\\\"},\\\"recipients\\\":[{\\\"address\\\":{\\\"email\\\":\\\"$to\\\"}}]}\"\n\n        # Send the API request and check for errors\n        response=$(curl -s -w \"%{http_code}\" -o /dev/null -XPOST -H \"Authorization: $sparkpost_api_key\" -H \"Content-Type: application/json\" -d \"$payload\" \"$sparkpost_api/transmissions\")\n        if [ \"$response\" == \"200\" ]; then\n            echo \"Email sent successfully for $disk_name.\"\n        else\n            echo \"Error sending email for $disk_name. Response code: $response\"\n        fi\n    fi\ndone\n```\nNote: Replace `example@example.com` with your actual email address, and replace `5d4d97f437cb777fdaa63f6c9af1e62230e7f12b` with your SparkPost API key. Also, make sure that you have the `curl` command installed on your system, as the script uses `curl` to send API requests to SparkPost.",
  "has_answer": false
}