{
  "turn_global_index": 90,
  "session_index": 8,
  "session_id": "sharegpt_3E7iMzS_93",
  "turn_in_session": 4,
  "date": "2023/05/22 (Mon) 22:34",
  "role": "assistant",
  "content": "Sure, here's an updated script that checks the disk usage of all mounted file systems and sends an email via SparkPost API if any of them are over 50% usage:\n```bash\n#!/bin/bash\n\n# Set the SparkPost API endpoint\nsparkpost_api=\"https://api.sparkpost.com/api/v1\"\n\n# Set your SparkPost API key\nsparkpost_api_key=\"5d4d97f437cb777fdaa63f6c9af1e62230e7f12b\"\n\n# Set the recipient email address\nto=\"es@x10hosting.com\"\n# set the from\nfrom=\"support@x10hosting.com\"\n\n# Set the email subject and message\nsubject=\"Disk space alert\"\nmessage=\"Your disk space on $(hostname) is over 50% full. Please take action to free up some space.\\n\\nDisk usage:\\n$(df -h)\"\n\n# Check disk usage and get the percentage used for each mounted file system\ndisks=$(df -h --output=source,pcent | tail -n +2 | sed 's/%//g' | tr -d '%')\nfor disk in $disks; do\n    disk_name=$(echo $disk | awk '{print $1}')\n    disk_usage=$(echo $disk | awk '{print $2}')\n    if [ \"$disk_usage\" -ge 50 ]; then\n        # If disk usage is over 50%, send an email via SparkPost API\n\n        # Generate the API request payload\n        payload=\"{\\\"options\\\":{\\\"sandbox\\\":false},\\\"content\\\":{\\\"from\\\":{\\\"email\\\":\\\"support@x10hosting.com\\\"},\\\"subject\\\":\\\"$subject\\\",\\\"text\\\":\\\"$message\\\"},\\\"recipients\\\":[{\\\"address\\\":{\\\"email\\\":\\\"$to\\\"}}]}\"\n\n        # Send the API request and check for errors\n        response=$(curl -s -w \"%{http_code}\" -o /dev/null -XPOST -H \"Authorization: $sparkpost_api_key\" -H \"Content-Type: application/json\" -d \"$payload\" \"$sparkpost_api/transmissions\")\n        if [ \"$response\" == \"200\" ]; then\n            echo \"Email sent successfully for $disk_name.\"\n        else\n            echo \"Error sending email for $disk_name. Response code: $response\"\n        fi\n    fi\ndone\n```\nNote that this script uses the SparkPost API to send emails, so you'll need to have a SparkPost API key and a valid recipient email address set in the script.",
  "has_answer": false
}