{
  "turn_global_index": 394,
  "session_index": 40,
  "session_id": "sharegpt_E69B6Mu_0",
  "turn_in_session": 1,
  "date": "2023/05/30 (Tue) 10:29",
  "role": "assistant",
  "content": "To set up a Docker Compose server with Nginx, Letsencrypt certbot, vhost, PHP 8.1, and MariaDB, you will need the following files:\n\n1. A `Dockerfile` for building the PHP 8.1 image.\n2. A `docker-compose.yml` file for defining the services and their dependencies.\n3. A `default.conf` file for the Nginx vhost configuration.\n4. An `entrypoint.sh` script to handle the Nginx and certbot configuration.\n5. Optionally, a `.env` file for storing environment variables.\n\nHere is an example of what these files might look like:\n\n**Dockerfile**\n```\nFROM php:8.1-fpm\n\n# Install dependencies\nRUN apt-get update && apt-get install -y \\\n        libfreetype6-dev \\\n        libjpeg62-turbo-dev \\\n        libpng-dev \\\n        libzip-dev \\\n        zip \\\n    && docker-php-ext-configure zip --with-libzip \\\n    && docker-php-ext-install -j$(nproc) pdo_mysql zip \\\n    && docker-php-ext-configure gd --with-freetype --with-jpeg \\\n    && docker-php-ext-install -j$(nproc) gd\n```\n**docker-compose.yml**\n```\nversion: '3.7'\n\nservices:\n  nginx:\n    image: nginx:latest\n    container_name: nginx\n    volumes:\n      - ./default.conf:/etc/nginx/conf.d/default.conf\n      - ./src:/var/www/html\n      - ./certs:/etc/letsencrypt\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n    depends_on:\n      - php\n      - certbot\n  certbot:\n    image: certbot/certbot\n    container_name: certbot\n    volumes:\n      - ./src:/var/www/html\n      - ./certs:/etc/letsencrypt\n    entrypoint: \"/entrypoint.sh\"\n  php:\n    build: .\n    container_name: php\n    volumes:\n      - ./src:/var/www/html\n    expose:\n      - \"9000\"\n  db:\n    image: mariadb:latest\n    container_name: db\n    environment:\n      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}\n      MYSQL_DATABASE: ${MYSQL_DATABASE}\n      MYSQL_USER: ${MYSQL_USER}\n      MYSQL_PASSWORD: ${MYSQL_PASSWORD}\n    volumes:\n      - db_data:/var/lib/mysql\n\nvolumes:\n  db_data:\n```\n**default.conf**\n```\nserver {\n    listen 80;\n    listen [::]:80;\n    server_name example.com www.example.com;\n    return 301 https://$server_name$request_uri;\n}\n\nserver {\n    listen 443 ssl;\n    listen [::]:443 ssl;\n    server_\n```",
  "has_answer": false
}