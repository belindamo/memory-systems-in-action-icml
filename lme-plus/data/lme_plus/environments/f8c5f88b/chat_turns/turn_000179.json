{
  "turn_global_index": 179,
  "session_index": 18,
  "session_id": "sharegpt_zq7r8FP_7",
  "turn_in_session": 0,
  "date": "2023/05/23 (Tue) 15:40",
  "role": "assistant",
  "content": "When a booking is made on Expedia.com, you will need to update the property availability on other OTAs and your PMS. Here's how you can implement this process:\n\n1. Receive the booking notification: Expedia.com will send a notification to your server when a booking is made. You will need to implement a webhook to receive this notification.\n2. Retrieve the booking details: Extract the booking details from the notification, including the property ID, booking dates, and other relevant information.\n3. Update the property availability on other OTAs: Use the worker pool approach described earlier to update the property availability on other OTAs. You will need to create a task for each OTA and add it to the worker queue. The task should include the OTA API endpoint for updating the property availability and the updated availability data.\n4. Update the property availability in your PMS: Update the property availability in your PMS using your PMS API.\n\nHere's an example code snippet of how you can implement the webhook to receive the booking notification and update the property availability:\n```javascript\nconst express = require('express');\nconst async = require('async');\nconst request = require('request');\n\nconst app = express();\nconst PORT = 3000;\n\n// Define the pool of workers\nconst workerPool = async.queue((task, callback) => {\n  // Execute the API request for each task\n  request.post(task.url, { json: task.body }, (err, response, body) => {\n    if (err) {\n      console.error(`Error executing API request for ${task.url}: ${err}`);\n      callback(err);\n    } else if (response.statusCode !== 200) {\n      console.error(`Received ${response.statusCode} status code from ${task.url}`);\n      callback(new Error(`Received ${response.statusCode} status code from ${task.url}`));\n    } else {\n      console.log(`API response from ${task.url}: ${JSON.stringify(body)}`);\n      callback(null, body);\n    }\n  });\n}, 2); // Set the concurrency limit to 2 workers\n\n// Define the webhook to handle Expedia booking notifications\napp.post('/expedia-booking-notification', (req, res) => {\n  const bookingData = req.body;\n\n  // Extract the booking details\n  const propertyId = bookingData.propertyId;\n  const startDate = bookingData.startDate;\n  const endDate = bookingData.endDate;\n\n  // Define the tasks for each OTA API endpoint\n  const tasks = [\n    { url: 'https://api.booking.com/v1/update-property-availability', body: { propertyId, startDate, endDate, availability: 'booked' } },\n    { url: 'https://api.vrbo.com/v1/update-property-availability', body: { propertyId, startDate, endDate, availability: 'booked' } }\n  ];\n\n  // Add the tasks to the worker queue\n  workerPool.push(tasks, (err, results) => {\n    if (err) {\n      console.error(`Error updating property availability: ${err}`);\n    } else {\n      console.log(`Updated property availability on ${results.length} OTAs`);\n    }\n  });\n\n  // Update the property availability in your PMS\n  // Your PMS API function for updating availability may vary\n  updatePmsAvailability(propertyId, startDate, endDate, 'booked')\n    .then(() => {\n      console.log('Updated property availability in PMS');\n      res.send({ success: true });\n    })\n    .catch((err) => {\n      console.error(`Error updating property availability in PMS: ${err}`);\n      res.status(500).send({ error: 'Error updating property availability in PMS' });\n    });\n});\n\napp.listen(PORT, () => console.log(`Server listening on port ${PORT}`\n```",
  "has_answer": false
}